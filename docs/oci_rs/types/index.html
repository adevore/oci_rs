<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <meta name="description" content="API documentation for the Rust `types` mod in crate `oci_rs`.">
    <meta name="keywords" content="rust, rustlang, rust-lang, types">

    <title>oci_rs::types - Rust</title>

    <link rel="stylesheet" type="text/css" href="../../normalize.css">
    <link rel="stylesheet" type="text/css" href="../../rustdoc.css">
    <link rel="stylesheet" type="text/css" href="../../main.css">
    

    
    
</head>
<body class="rustdoc mod">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

    

    <nav class="sidebar">
        
        <p class='location'>Module types</p><div class="block items"><ul><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li></ul></div><p class='location'><a href='../index.html'>oci_rs</a></p><script>window.sidebarCurrent = {name: 'types', ty: 'mod', relpath: '../'};</script><script defer src="../sidebar-items.js"></script>
    </nav>

    <nav class="sub">
        <form class="search-form js-only">
            <div class="search-container">
                <input class="search-input" name="search"
                       autocomplete="off"
                       placeholder="Click or press ‘S’ to search, ‘?’ for more options…"
                       type="search">
            </div>
        </form>
    </nav>

    <section id='main' class="content">
<h1 class='fqn'><span class='in-band'>Module <a href='../index.html'>oci_rs</a>::<wbr><a class="mod" href=''>types</a></span><span class='out-of-band'><span id='render-detail'>
                   <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">
                       [<span class='inner'>&#x2212;</span>]
                   </a>
               </span><a class='srclink' href='../../src/oci_rs/types.rs.html#1-194' title='goto source code'>[src]</a></span></h1>
<div class='docblock'><p>Types used in conversion between OCI and Rust types.</p>

<p>This module provides a type <code>SqlValue</code> and two traits <code>ToSqlValue</code> and <code>FromSqlValue</code> that
allow the underlying OCI types to be converted into Rust types. They do not map exactly to the
corresponding SQL standard types.</p>

<p>For number types in particular there are less <code>SqlValue</code>s than SQL types. Inside Oracle all
numbers are stored as a <code>NUMBER</code>. This is an Oracle format that can handle all integer and
float values with a precision of 38 digits. Regardless of whether the SQL statement specifies
an <code>INTEGER</code> or <code>FLOAT</code> or <code>LONG</code>, Oracle will store it as a <code>NUMBER</code>. The OCI library then allows you
to convert it into any numeric type you like, but that forces you to explicitly state the type
of the columns when retrieving the values. To avoid this, this crate makes some executive
decisions based on the <code>NUMBER</code> value. As per the OCI documentation the basic type of a number can be
determined by the scale and precision of the <code>NUMBER</code> value. If the precision is non-zero and
scale is -127 then the number is a <code>FLOAT</code> otherwise we can consider it an <code>INTEGER</code>. 
So, according to this logic the caller will receive either <code>SqlValue::Integer</code> or <code>SqlValue::Float</code>. 
These two variants contain an <code>i64</code> and <code>f64</code> respectively. If a smaller type is needed in Rust code, 
then further conversions can be made. This appears to be sufficient to allow retrieval of data in 
queries, without having specify column types on the Rust side ahead of time.</p>

<p>Note: Oracle also supports types known as <code>BINARY_FLOAT</code> and <code>BINARY_DOUBLE</code>. These can also be
used to store numbers inside the database as an alternative to <code>NUMBER</code>. They are not currently
supported.</p>

<p>The traits allow conversion to and from Rust types into <code>SqlValue</code>.</p>

<h1 id='examples' class='section-header'><a href='#examples'>Examples</a></h1>
<p>This example highlights the automatic conversion. If it is confusing then I suggest reading
<a href="https://github.com/jaheba/stuff/blob/master/communicating_intent.md">Communicating Intent</a> as it explains very well how Rust&#39;s trait system makes this work,
the <a href="https://crates.io/crates/postgres"><code>postgres</code></a> crate also makes use of the same process to
convert the column values in a result row into Rust. This crate copies <code>postgres</code>&#39;s approach except that it
makes use of an intermediary <code>SqlValue</code> instead of returning a trait. I think that it is fair
to argue that <code>SqlValue</code> is not needed, <code>postgres</code> skips such an intermediary value, but using
it simplifies the current implementation.</p>

<pre class="rust rust-example-rendered">
<span class="kw">use</span> <span class="ident">oci_rs</span>::<span class="ident">connection</span>::<span class="ident">Connection</span>;

<span class="kw">let</span> <span class="ident">conn</span> <span class="op">=</span> <span class="ident">Connection</span>::<span class="ident">new</span>(<span class="string">&quot;localhost:1521/xe&quot;</span>, <span class="string">&quot;oci_rs&quot;</span>, <span class="string">&quot;test&quot;</span>).<span class="ident">unwrap</span>();

<span class="comment">// Create a table</span>
<span class="kw">let</span> <span class="ident">sql_create</span> <span class="op">=</span> <span class="string">&quot;CREATE TABLE Men (ManId INTEGER,
                                    Name VARCHAR2(20),
                                    Height FLOAT)&quot;</span>;

<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">create</span> <span class="op">=</span> <span class="ident">conn</span>.<span class="ident">create_prepared_statement</span>(<span class="ident">sql_create</span>).<span class="ident">unwrap</span>();

<span class="comment">// Execute the create statement</span>
<span class="ident">create</span>.<span class="ident">execute</span>().<span class="ident">unwrap</span>();

<span class="comment">// Commit in case we lose connection (an abnormal disconnection would result</span>
<span class="comment">// in an automatic roll-back.)</span>
<span class="ident">create</span>.<span class="ident">commit</span>().<span class="ident">unwrap</span>();

<span class="comment">// Insert some values</span>
<span class="kw">let</span> <span class="ident">sql_insert</span> <span class="op">=</span> <span class="string">&quot;INSERT INTO Men (ManId, Name, Height)
                  VALUES (1, &#39;Roger&#39;, 183.4)&quot;</span>;
 <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">insert</span> <span class="op">=</span> <span class="ident">conn</span>.<span class="ident">create_prepared_statement</span>(<span class="ident">sql_insert</span>).<span class="ident">unwrap</span>();

<span class="ident">insert</span>.<span class="ident">execute</span>().<span class="ident">unwrap</span>();
<span class="ident">insert</span>.<span class="ident">commit</span>().<span class="ident">unwrap</span>();

<span class="comment">// Create a query</span>
<span class="kw">let</span> <span class="ident">sql_select</span> <span class="op">=</span> <span class="string">&quot;SELECT * FROM Men&quot;</span>;

<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">select</span> <span class="op">=</span> <span class="ident">conn</span>.<span class="ident">create_prepared_statement</span>(<span class="ident">sql_select</span>).<span class="ident">unwrap</span>();

<span class="comment">// Execute</span>
<span class="ident">select</span>.<span class="ident">execute</span>().<span class="ident">unwrap</span>();

<span class="comment">// Get the result set</span>
<span class="kw">let</span> <span class="ident">result_set</span> <span class="op">=</span> <span class="ident">select</span>.<span class="ident">result_set</span>().<span class="ident">unwrap</span>();
<span class="macro">assert_eq</span><span class="macro">!</span>(<span class="ident">result_set</span>.<span class="ident">len</span>(), <span class="number">1</span>);
<span class="kw">let</span> <span class="ident">first_row</span> <span class="op">=</span> <span class="kw-2">&amp;</span><span class="ident">result_set</span>[<span class="number">0</span>];

<span class="comment">// Types are automatically converted</span>
<span class="kw">let</span> <span class="ident">id</span>: <span class="ident">i64</span> <span class="op">=</span> <span class="ident">first_row</span>[<span class="number">0</span>].<span class="ident">value</span>().<span class="ident">unwrap</span>();
<span class="kw">let</span> <span class="ident">name</span>: <span class="ident">String</span> <span class="op">=</span> <span class="ident">first_row</span>[<span class="number">1</span>].<span class="ident">value</span>().<span class="ident">unwrap</span>();
<span class="kw">let</span> <span class="ident">height</span>: <span class="ident">f64</span> <span class="op">=</span> <span class="ident">first_row</span>[<span class="number">2</span>].<span class="ident">value</span>().<span class="ident">unwrap</span>();

<span class="macro">assert_eq</span><span class="macro">!</span>(<span class="ident">id</span>, <span class="number">1</span>);
<span class="macro">assert_eq</span><span class="macro">!</span>(<span class="ident">name</span>, <span class="string">&quot;Roger&quot;</span>);
<span class="macro">assert_eq</span><span class="macro">!</span>(<span class="ident">height</span>, <span class="number">183.4</span>);

<span class="comment">// Integer and Float can also be turned into Strings</span>
<span class="kw">let</span> <span class="ident">id_as_string</span>: <span class="ident">String</span> <span class="op">=</span> <span class="ident">first_row</span>[<span class="number">0</span>].<span class="ident">value</span>().<span class="ident">unwrap</span>();
<span class="kw">let</span> <span class="ident">height_as_string</span>: <span class="ident">String</span> <span class="op">=</span> <span class="ident">first_row</span>[<span class="number">2</span>].<span class="ident">value</span>().<span class="ident">unwrap</span>();

<span class="macro">assert_eq</span><span class="macro">!</span>(<span class="ident">id_as_string</span>, <span class="string">&quot;1&quot;</span>);
<span class="macro">assert_eq</span><span class="macro">!</span>(<span class="ident">height_as_string</span>, <span class="string">&quot;183.4&quot;</span>);</pre>
</div><h2 id='enums' class='section-header'><a href="#enums">Enums</a></h2>
<table>
                       <tr class=' module-item'>
                           <td><a class="enum" href="enum.SqlValue.html"
                                  title='enum oci_rs::types::SqlValue'>SqlValue</a></td>
                           <td class='docblock-short'>
                                <p>The types that support conversion from OCI to Rust types.</p>
                           </td>
                       </tr></table><h2 id='traits' class='section-header'><a href="#traits">Traits</a></h2>
<table>
                       <tr class=' module-item'>
                           <td><a class="trait" href="trait.FromSqlValue.html"
                                  title='trait oci_rs::types::FromSqlValue'>FromSqlValue</a></td>
                           <td class='docblock-short'>
                                <p>Allows conversion from a <code>SqlValue</code>.</p>
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class="trait" href="trait.ToSqlValue.html"
                                  title='trait oci_rs::types::ToSqlValue'>ToSqlValue</a></td>
                           <td class='docblock-short'>
                                <p>Allows conversion into a <code>SqlValue</code>.</p>
                           </td>
                       </tr></table></section>
    <section id='search' class="content hidden"></section>

    <section class="footer"></section>

    <aside id="help" class="hidden">
        <div>
            <h1 class="hidden">Help</h1>

            <div class="shortcuts">
                <h2>Keyboard Shortcuts</h2>

                <dl>
                    <dt>?</dt>
                    <dd>Show this help dialog</dd>
                    <dt>S</dt>
                    <dd>Focus the search field</dd>
                    <dt>&larrb;</dt>
                    <dd>Move up in search results</dd>
                    <dt>&rarrb;</dt>
                    <dd>Move down in search results</dd>
                    <dt>&#9166;</dt>
                    <dd>Go to active search result</dd>
                    <dt>+</dt>
                    <dd>Collapse/expand all sections</dd>
                </dl>
            </div>

            <div class="infos">
                <h2>Search Tricks</h2>

                <p>
                    Prefix searches with a type followed by a colon (e.g.
                    <code>fn:</code>) to restrict the search to a given type.
                </p>

                <p>
                    Accepted types are: <code>fn</code>, <code>mod</code>,
                    <code>struct</code>, <code>enum</code>,
                    <code>trait</code>, <code>type</code>, <code>macro</code>,
                    and <code>const</code>.
                </p>

                <p>
                    Search functions by type signature (e.g.
                    <code>vec -> usize</code> or <code>* -> vec</code>)
                </p>
            </div>
        </div>
    </aside>

    

    <script>
        window.rootPath = "../../";
        window.currentCrate = "oci_rs";
    </script>
    <script src="../../jquery.js"></script>
    <script src="../../main.js"></script>
    <script defer src="../../search-index.js"></script>
</body>
</html>