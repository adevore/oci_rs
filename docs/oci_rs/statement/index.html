<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <meta name="description" content="API documentation for the Rust `statement` mod in crate `oci_rs`.">
    <meta name="keywords" content="rust, rustlang, rust-lang, statement">

    <title>oci_rs::statement - Rust</title>

    <link rel="stylesheet" type="text/css" href="../../normalize.css">
    <link rel="stylesheet" type="text/css" href="../../rustdoc.css">
    <link rel="stylesheet" type="text/css" href="../../main.css">
    

    
    
</head>
<body class="rustdoc mod">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

    

    <nav class="sidebar">
        
        <p class='location'>Module statement</p><div class="block items"><ul><li><a href="#structs">Structs</a></li></ul></div><p class='location'><a href='../index.html'>oci_rs</a></p><script>window.sidebarCurrent = {name: 'statement', ty: 'mod', relpath: '../'};</script><script defer src="../sidebar-items.js"></script>
    </nav>

    <nav class="sub">
        <form class="search-form js-only">
            <div class="search-container">
                <input class="search-input" name="search"
                       autocomplete="off"
                       placeholder="Click or press ‘S’ to search, ‘?’ for more options…"
                       type="search">
            </div>
        </form>
    </nav>

    <section id='main' class="content">
<h1 class='fqn'><span class='in-band'>Module <a href='../index.html'>oci_rs</a>::<wbr><a class="mod" href=''>statement</a></span><span class='out-of-band'><span id='render-detail'>
                   <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">
                       [<span class='inner'>&#x2212;</span>]
                   </a>
               </span><a class='srclink' href='../../src/oci_rs/statement.rs.html#1-808' title='goto source code'>[src]</a></span></h1>
<div class='docblock'><p>SQL statements run against the database.</p>

<p><code>Statement</code>s are created to run a SQL Statement against a database. They prepare the statement
for execution and allow bind variables to be set. If there are results then these these can be
returned all in one go or lazily through an iterator.</p>

<h1 id='overview' class='section-header'><a href='#overview'>Overview</a></h1>
<p>The process is as follows:</p>

<ol>
<li>Create a <code>Statement</code> from a connection with a given SQL statement. This will create a
prepared statement on the Oracle side.</li>
<li>If the SQL contains bind variable placeholders then these values should now be set via a
call to <code>.bind</code>. Although OCI supports both positional and named bind variables, only
positional are curently support by <code>Statement</code>. Oracle uses the form <code>:name</code> where <code>name</code>is
the bind variable.</li>
<li>Execute the statement.</li>
<li>Commit the transaction if data was changed. Oracle implicitly creates a transaction when data
is changed and commits automatically with a normal session close and log-off. If we
disconnect abnormally however, a rollback is initiated.</li>
<li>If there are results i.e. it was a <code>SELECT</code> statement, then fetch the results. The entire
result set can be returned as a <code>Vec&lt;Row&gt;</code> or instead an iterator can be used to return the
<code>Row</code>s one by one. These are fetched from OCI by the iterator as needed.</li>
</ol>

<p>A connection can create multiple <code>Statement</code>s. In the examples in this document there is
usually one for each of the <code>DROP</code>, <code>CREATE</code>, <code>INSERT</code> and <code>SELECT</code> SQL statements used in the
examples.</p>

<h1 id='examples' class='section-header'><a href='#examples'>Examples</a></h1>
<p>We will run through the above process to create a table, add some values and then return them
lazily. Every OCI call can fail and the below example avoids handling errors in order to make
the example easier to read, notice how many <code>.unwrap</code>s are here.</p>

<pre class="rust rust-example-rendered">
<span class="kw">use</span> <span class="ident">oci_rs</span>::<span class="ident">connection</span>::<span class="ident">Connection</span>;
<span class="kw">use</span> <span class="ident">oci_rs</span>::<span class="ident">row</span>::<span class="ident">Row</span>;

<span class="kw">let</span> <span class="ident">conn</span> <span class="op">=</span> <span class="ident">Connection</span>::<span class="ident">new</span>(<span class="string">&quot;localhost:1521/xe&quot;</span>, <span class="string">&quot;oci_rs&quot;</span>, <span class="string">&quot;test&quot;</span>).<span class="ident">unwrap</span>();

<span class="comment">// Create a table</span>
<span class="kw">let</span> <span class="ident">sql_create</span> <span class="op">=</span> <span class="string">&quot;CREATE TABLE Cities (CityId INTEGER,
                                       Name VARCHAR(20))&quot;</span>;

<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">create</span> <span class="op">=</span> <span class="ident">conn</span>.<span class="ident">create_prepared_statement</span>(<span class="ident">sql_create</span>).<span class="ident">unwrap</span>();

<span class="comment">// Execute the create statement</span>
<span class="ident">create</span>.<span class="ident">execute</span>().<span class="ident">unwrap</span>();

<span class="comment">// Commit in case we lose connection (an abnormal disconnection would result</span>
<span class="comment">// in an automatic roll-back.)</span>
<span class="ident">create</span>.<span class="ident">commit</span>().<span class="ident">unwrap</span>();

<span class="comment">// Insert some values using bind variables</span>
<span class="kw">let</span> <span class="ident">sql_insert</span> <span class="op">=</span> <span class="string">&quot;INSERT INTO Cities (CityId, Name)
                  VALUES (:id, :name)&quot;</span>;
<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">insert</span> <span class="op">=</span> <span class="ident">conn</span>.<span class="ident">create_prepared_statement</span>(<span class="ident">sql_insert</span>).<span class="ident">unwrap</span>();

<span class="kw">let</span> <span class="ident">values</span> <span class="op">=</span> <span class="macro">vec</span><span class="macro">!</span>[(<span class="number">1</span>, <span class="string">&quot;Paris&quot;</span>),
                  (<span class="number">2</span>, <span class="string">&quot;London&quot;</span>),
                  (<span class="number">3</span>, <span class="string">&quot;Hamburg&quot;</span>),
                  (<span class="number">4</span>, <span class="string">&quot;Miami&quot;</span>)];

<span class="comment">// Run through the list of values, bind them and execute the statement</span>
<span class="kw">for</span> <span class="ident">value</span> <span class="kw">in</span> <span class="ident">values</span>.<span class="ident">iter</span>() {
    <span class="ident">insert</span>.<span class="ident">bind</span>(<span class="kw-2">&amp;</span>[<span class="kw-2">&amp;</span><span class="ident">value</span>.<span class="number">0</span>, <span class="kw-2">&amp;</span><span class="ident">value</span>.<span class="number">1</span>]).<span class="ident">unwrap</span>();
    <span class="ident">insert</span>.<span class="ident">execute</span>().<span class="ident">unwrap</span>()
}

<span class="ident">insert</span>.<span class="ident">commit</span>().<span class="ident">unwrap</span>();

<span class="comment">// Create a query</span>
<span class="kw">let</span> <span class="ident">sql_select</span> <span class="op">=</span> <span class="string">&quot;SELECT * FROM Cities&quot;</span>;

<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">select</span> <span class="op">=</span> <span class="ident">conn</span>.<span class="ident">create_prepared_statement</span>(<span class="ident">sql_select</span>).<span class="ident">unwrap</span>();

<span class="comment">// Execute</span>
<span class="ident">select</span>.<span class="ident">execute</span>().<span class="ident">unwrap</span>();

<span class="comment">// Get the result set row by row from an iterator</span>
<span class="kw">for</span> (<span class="ident">index</span>, <span class="ident">row_result</span>) <span class="kw">in</span> <span class="ident">select</span>.<span class="ident">lazy_result_set</span>().<span class="ident">enumerate</span>(){
    <span class="kw">let</span> <span class="ident">row</span> <span class="op">=</span> <span class="ident">row_result</span>.<span class="ident">unwrap</span>();
    <span class="kw">let</span> <span class="ident">city_id</span>: <span class="ident">i64</span> <span class="op">=</span> <span class="ident">row</span>[<span class="number">0</span>].<span class="ident">value</span>().<span class="ident">unwrap</span>();
    <span class="kw">let</span> <span class="ident">city_name</span>: <span class="ident">String</span> <span class="op">=</span> <span class="ident">row</span>[<span class="number">1</span>].<span class="ident">value</span>().<span class="ident">unwrap</span>();
    <span class="macro">assert_eq</span><span class="macro">!</span>(<span class="ident">city_id</span>, <span class="ident">values</span>[<span class="ident">index</span>].<span class="number">0</span>);
    <span class="macro">assert_eq</span><span class="macro">!</span>(<span class="ident">city_name</span>, <span class="ident">values</span>[<span class="ident">index</span>].<span class="number">1</span>);
}

<span class="comment">// Or perhaps something a bit more convoluted just to make use of iterator adapters</span>

<span class="comment">// Execute again to get fresh results</span>
<span class="ident">select</span>.<span class="ident">execute</span>().<span class="ident">unwrap</span>();

<span class="comment">// Get cities containing an &#39;a&#39;:</span>
<span class="kw">let</span> <span class="ident">results</span>: <span class="ident">Vec</span><span class="op">&lt;</span><span class="ident">String</span><span class="op">&gt;</span> <span class="op">=</span> <span class="ident">select</span>.<span class="ident">lazy_result_set</span>()
                                 .<span class="ident">map</span>(<span class="op">|</span><span class="ident">row_result</span><span class="op">|</span> {
                                          <span class="kw">let</span> <span class="ident">row</span> <span class="op">=</span> <span class="ident">row_result</span>.<span class="ident">unwrap</span>();
                                          <span class="ident">row</span>[<span class="number">1</span>].<span class="ident">value</span>::<span class="op">&lt;</span><span class="ident">String</span><span class="op">&gt;</span>().<span class="ident">unwrap</span>()
                                      })
                                 .<span class="ident">filter</span>(<span class="op">|</span><span class="ident">city</span><span class="op">|</span> <span class="ident">city</span>.<span class="ident">contains</span>(<span class="string">&quot;a&quot;</span>))
                                 .<span class="ident">collect</span>();

<span class="kw">let</span> <span class="ident">correct_result</span> <span class="op">=</span> <span class="macro">vec</span><span class="macro">!</span>[<span class="string">&quot;Paris&quot;</span>.<span class="ident">to_string</span>(),
                          <span class="string">&quot;Hamburg&quot;</span>.<span class="ident">to_string</span>(),
                          <span class="string">&quot;Miami&quot;</span>.<span class="ident">to_string</span>()];
<span class="macro">assert_eq</span><span class="macro">!</span>(<span class="ident">results</span>, <span class="ident">correct_result</span>);</pre>

<p>The final example is a bit awkard because we have <code>Result</code>s and <code>Option</code>s to deal with
(or ignored as in this case) but it is added as a reminder that iterator methods can be used.</p>
</div><h2 id='structs' class='section-header'><a href="#structs">Structs</a></h2>
<table>
                       <tr class=' module-item'>
                           <td><a class="struct" href="struct.RowIter.html"
                                  title='struct oci_rs::statement::RowIter'>RowIter</a></td>
                           <td class='docblock-short'>
                                <p>An iterator that will allow results to be returned row by row.</p>
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class="struct" href="struct.Statement.html"
                                  title='struct oci_rs::statement::Statement'>Statement</a></td>
                           <td class='docblock-short'>
                                <p>Represents a statement that is executed against a database.</p>
                           </td>
                       </tr></table></section>
    <section id='search' class="content hidden"></section>

    <section class="footer"></section>

    <aside id="help" class="hidden">
        <div>
            <h1 class="hidden">Help</h1>

            <div class="shortcuts">
                <h2>Keyboard Shortcuts</h2>

                <dl>
                    <dt>?</dt>
                    <dd>Show this help dialog</dd>
                    <dt>S</dt>
                    <dd>Focus the search field</dd>
                    <dt>&larrb;</dt>
                    <dd>Move up in search results</dd>
                    <dt>&rarrb;</dt>
                    <dd>Move down in search results</dd>
                    <dt>&#9166;</dt>
                    <dd>Go to active search result</dd>
                    <dt>+</dt>
                    <dd>Collapse/expand all sections</dd>
                </dl>
            </div>

            <div class="infos">
                <h2>Search Tricks</h2>

                <p>
                    Prefix searches with a type followed by a colon (e.g.
                    <code>fn:</code>) to restrict the search to a given type.
                </p>

                <p>
                    Accepted types are: <code>fn</code>, <code>mod</code>,
                    <code>struct</code>, <code>enum</code>,
                    <code>trait</code>, <code>type</code>, <code>macro</code>,
                    and <code>const</code>.
                </p>

                <p>
                    Search functions by type signature (e.g.
                    <code>vec -> usize</code> or <code>* -> vec</code>)
                </p>
            </div>
        </div>
    </aside>

    

    <script>
        window.rootPath = "../../";
        window.currentCrate = "oci_rs";
    </script>
    <script src="../../jquery.js"></script>
    <script src="../../main.js"></script>
    <script defer src="../../search-index.js"></script>
</body>
</html>