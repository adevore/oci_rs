<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="rustdoc">
    <meta name="description" content="API documentation for the Rust `oci_rs` crate.">
    <meta name="keywords" content="rust, rustlang, rust-lang, oci_rs">

    <title>oci_rs - Rust</title>

    <link rel="stylesheet" type="text/css" href="../normalize.css">
    <link rel="stylesheet" type="text/css" href="../rustdoc.css">
    <link rel="stylesheet" type="text/css" href="../main.css">
    

    
    
</head>
<body class="rustdoc mod">
    <!--[if lte IE 8]>
    <div class="warning">
        This old browser is unsupported and will most likely display funky
        things.
    </div>
    <![endif]-->

    

    <nav class="sidebar">
        
        <p class='location'>Crate oci_rs</p><div class="block items"><ul><li><a href="#modules">Modules</a></li></ul></div><p class='location'></p><script>window.sidebarCurrent = {name: 'oci_rs', ty: 'mod', relpath: '../'};</script>
    </nav>

    <nav class="sub">
        <form class="search-form js-only">
            <div class="search-container">
                <input class="search-input" name="search"
                       autocomplete="off"
                       placeholder="Click or press ‘S’ to search, ‘?’ for more options…"
                       type="search">
            </div>
        </form>
    </nav>

    <section id='main' class="content">
<h1 class='fqn'><span class='in-band'>Crate <a class="mod" href=''>oci_rs</a></span><span class='out-of-band'><span id='render-detail'>
                   <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">
                       [<span class='inner'>&#x2212;</span>]
                   </a>
               </span><a class='srclink' href='../src/oci_rs/lib.rs.html#1-793' title='goto source code'>[src]</a></span></h1>
<div class='docblock'><p>This crate provides a Rust wrapper to the <a href="http://www.oracle.com/technetwork/database/features/oci/index-090945.html">Oracle Call Interface</a> (OCI) library.
The Oracle site describes OCI as a &quot;...comprehensive, high performance, native C
language interface to Oracle Database for custom or packaged applications...&quot;.</p>

<h1 id='overview' class='section-header'><a href='#overview'>Overview</a></h1>
<p>The OCI library is the original Oracle C API for interacting with their database. It is the one
that later versions of JDBC is built on for example. Recently Oracle has released a new API
called the <a href="https://github.com/oracle/odpi">Oracle Database Programming Interface for Drivers and Applications</a> (ODPI-C)
that is supposed to simplify use of OCI, however the documentation for OCI
is more extensive and therefore easier to build a wrapper on top of.</p>

<p>The OCI library is large and supports many use cases for interacting with a database. This
crate is currently concerned with support for executing SQL statements and so is limited when
compared to the whole of OCI.</p>

<p>The overall design will be familiar to anyone who has used Java&#39;s JDBC, Haskell&#39;s HDBC or
Rust&#39;s <a href="https://crates.io/crates/postgres">postgres</a> crate. Indeed, most design decisions were
made based on reviewing the API of these libraries.</p>

<p>The basics are simple: a <a href="connection/struct.Connection.html"><code>Connection</code></a> represents a connection to a database, this connection
can be used to prepare one or more <a href="statement/struct.Statement.html"><code>Statement</code></a>s which are then used to execute SQL against the
database. If there are results then they can be returned all at once or lazily via an iterator.
Datatypes are represented using <a href="types/enum.SqlValue.html"><code>SqlValue</code></a> and allow type conversion from Oracle
to Rust types.</p>

<h2 id='missing-type-conversions' class='section-header'><a href='#missing-type-conversions'>Missing type conversions</a></h2>
<p>Currently only <code>String</code>, <code>i64</code> and <code>f64</code> are supported. In Oracle terms this means that anything
held in columns as <code>VARCHAR</code>, <code>VARCHAR2</code> and <code>Number</code> can be retrieved. As Oracle uses <code>Number</code> to
respresent all number types then this is less restricting that it first appears. More types
will be added.</p>

<h1 id='setup' class='section-header'><a href='#setup'>Setup</a></h1>
<p>This crate is developed against version 12.2 of the OCI library. It is expected to work with
12.x.x but is not tested. The OCI client library needs to be installed on your machine and can be
downloaded <a href="http://www.oracle.com/technetwork/database/features/instant-client/index-097480.html">here</a>.</p>

<p>If you are on Linux then you are likely to need to tell the linker where
to find the files. Adding this to my <code>.bashrc</code> file worked for me, however the details may vary
according to your distro, mine is <a href="https://www.opensuse.org/">OpenSuse</a>.</p>

<pre><code class="language-text">export LIBRARY_PATH=$LIBRARY_PATH:/usr/lib/oracle/12.2/client64/lib/
</code></pre>

<p>This crate has not been tested against Windows and so the setup will be different.</p>

<p>Testing has been done against a local installation of <a href="http://www.oracle.com/technetwork/database/database-technologies/express-edition/overview/index.html">Oracle 11g Express Edition</a>.
In order to run the crate tests then a local database needs to be
available on <code>localhost:1521/xe</code> with a user <code>oci_rs</code> and password <code>test</code>.</p>

<p>In order to use <code>oci_rs</code> add this to your <code>Cargo.toml</code>:</p>

<pre><code class="language-toml">[dependencies]
oci_rs = &quot;0.3.0&quot;
</code></pre>

<p>and this to your crate root:</p>

<pre class="rust rust-example-rendered">
<span class="kw">extern</span> <span class="kw">crate</span> <span class="ident">oci_rs</span>;</pre>

<h1 id='examples' class='section-header'><a href='#examples'>Examples</a></h1>
<p>In the following example we will create a connection to a database and then create a table,
insert a couple of rows using bind variables and then execute a query to fetch them back again.
There is a lot of error handling needed. Every OCI function call can fail and so <code>Result</code> and
<code>Option</code> are used extensively. The below code takes the usual documentation shortcut of calling
<code>unwrap()</code> a lot but doing so in real client code will prove ill-fated. Any remote database connection is
inherently unreliable.</p>

<pre class="rust rust-example-rendered">
<span class="kw">use</span> <span class="ident">oci_rs</span>::<span class="ident">connection</span>::<span class="ident">Connection</span>;

<span class="kw">let</span> <span class="ident">conn</span> <span class="op">=</span> <span class="ident">Connection</span>::<span class="ident">new</span>(<span class="string">&quot;localhost:1521/xe&quot;</span>, <span class="string">&quot;oci_rs&quot;</span>, <span class="string">&quot;test&quot;</span>).<span class="ident">unwrap</span>();


<span class="comment">// Create a table</span>
<span class="kw">let</span> <span class="ident">sql_create</span> <span class="op">=</span> <span class="string">&quot;CREATE TABLE Toys (ToyId int,
                                     Name varchar(20),
                                     Price float)&quot;</span>;
<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">create</span> <span class="op">=</span> <span class="ident">conn</span>.<span class="ident">create_prepared_statement</span>(<span class="ident">sql_create</span>).<span class="ident">unwrap</span>();

<span class="comment">// Execute the create statement</span>
<span class="ident">create</span>.<span class="ident">execute</span>().<span class="ident">unwrap</span>();

<span class="comment">// Commit in case we lose connection (an abnormal disconnection would result</span>
<span class="comment">// in an automatic roll-back.)</span>
<span class="ident">create</span>.<span class="ident">commit</span>().<span class="ident">unwrap</span>();

<span class="comment">// Insert some values using bind variables</span>
<span class="kw">let</span> <span class="ident">sql_insert</span> <span class="op">=</span> <span class="string">&quot;INSERT INTO Toys (ToyId, Name, Price)
                  VALUES (:id, :name, :price)&quot;</span>;
<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">insert</span> <span class="op">=</span> <span class="ident">conn</span>.<span class="ident">create_prepared_statement</span>(<span class="ident">sql_insert</span>).<span class="ident">unwrap</span>();

<span class="kw">let</span> <span class="ident">values</span> <span class="op">=</span> [(<span class="number">1</span>, <span class="string">&quot;Barbie&quot;</span>, <span class="number">23.45</span>),
              (<span class="number">2</span>, <span class="string">&quot;Dinosaurs&quot;</span>, <span class="op">-</span><span class="number">5.21</span>)];

<span class="comment">// Run through the list of values, bind them and execute the statement</span>
<span class="kw">for</span> <span class="ident">value</span> <span class="kw">in</span> <span class="ident">values</span>.<span class="ident">iter</span>() {
    <span class="ident">insert</span>.<span class="ident">bind</span>(<span class="kw-2">&amp;</span>[<span class="kw-2">&amp;</span><span class="ident">value</span>.<span class="number">0</span>, <span class="kw-2">&amp;</span><span class="ident">value</span>.<span class="number">1</span>, <span class="kw-2">&amp;</span><span class="ident">value</span>.<span class="number">2</span>]).<span class="ident">unwrap</span>();
    <span class="ident">insert</span>.<span class="ident">execute</span>().<span class="ident">unwrap</span>()
}

<span class="ident">insert</span>.<span class="ident">commit</span>().<span class="ident">unwrap</span>();

<span class="comment">// Create a query</span>
<span class="kw">let</span> <span class="ident">sql_select</span> <span class="op">=</span> <span class="string">&quot;SELECT * FROM Toys
                  WHERE Name=&#39;Barbie&#39;&quot;</span>;

<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">select</span> <span class="op">=</span> <span class="ident">conn</span>.<span class="ident">create_prepared_statement</span>(<span class="ident">sql_select</span>).<span class="ident">unwrap</span>();

<span class="comment">// Execute</span>
<span class="ident">select</span>.<span class="ident">execute</span>().<span class="ident">unwrap</span>();

<span class="comment">// Get the result set</span>
<span class="kw">let</span> <span class="ident">result_set</span> <span class="op">=</span> <span class="ident">select</span>.<span class="ident">result_set</span>().<span class="ident">unwrap</span>();
<span class="macro">assert_eq</span><span class="macro">!</span>(<span class="ident">result_set</span>.<span class="ident">len</span>(), <span class="number">1</span>);
<span class="kw">let</span> <span class="ident">first_row</span> <span class="op">=</span> <span class="kw-2">&amp;</span><span class="ident">result_set</span>[<span class="number">0</span>];

<span class="comment">// Types are automatically converted</span>
<span class="kw">let</span> <span class="ident">id</span>: <span class="ident">i64</span> <span class="op">=</span> <span class="ident">first_row</span>[<span class="number">0</span>].<span class="ident">value</span>().<span class="ident">unwrap</span>();
<span class="kw">let</span> <span class="ident">name</span>: <span class="ident">String</span> <span class="op">=</span> <span class="ident">first_row</span>[<span class="number">1</span>].<span class="ident">value</span>().<span class="ident">unwrap</span>();
<span class="kw">let</span> <span class="ident">price</span>: <span class="ident">f64</span> <span class="op">=</span> <span class="ident">first_row</span>[<span class="number">2</span>].<span class="ident">value</span>().<span class="ident">unwrap</span>();

<span class="macro">assert_eq</span><span class="macro">!</span>(<span class="ident">id</span>, <span class="number">1</span>);
<span class="macro">assert_eq</span><span class="macro">!</span>(<span class="ident">name</span>, <span class="string">&quot;Barbie&quot;</span>);
<span class="macro">assert_eq</span><span class="macro">!</span>(<span class="ident">price</span>, <span class="number">23.45</span>);
</pre>

<h1 id='oci-docs' class='section-header'><a href='#oci-docs'>OCI docs</a></h1>
<p>Documentation for the underlying OCI library can be found <a href="http://docs.oracle.com/database/122/LNOCI/toc.html">here</a> and error codes and their
descriptions <a href="https://docs.oracle.com/database/122/ERRMG/toc.html">here</a>. The error descriptions are useful because they often contain
additional information that is not included in the text returned from the library.</p>
</div><h2 id='modules' class='section-header'><a href="#modules">Modules</a></h2>
<table>
                       <tr class=' module-item'>
                           <td><a class="mod" href="connection/index.html"
                                  title='mod oci_rs::connection'>connection</a></td>
                           <td class='docblock-short'>
                                <p>Connections to a database.</p>
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class="mod" href="oci_error/index.html"
                                  title='mod oci_rs::oci_error'>oci_error</a></td>
                           <td class='docblock-short'>
                                <p>Errors.</p>
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class="mod" href="row/index.html"
                                  title='mod oci_rs::row'>row</a></td>
                           <td class='docblock-short'>
                                <p>Rows of data returned from a query</p>
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class="mod" href="statement/index.html"
                                  title='mod oci_rs::statement'>statement</a></td>
                           <td class='docblock-short'>
                                <p>SQL statements run against the database.</p>
                           </td>
                       </tr>
                       <tr class=' module-item'>
                           <td><a class="mod" href="types/index.html"
                                  title='mod oci_rs::types'>types</a></td>
                           <td class='docblock-short'>
                                <p>Types used in conversion between OCI and Rust types.</p>
                           </td>
                       </tr></table></section>
    <section id='search' class="content hidden"></section>

    <section class="footer"></section>

    <aside id="help" class="hidden">
        <div>
            <h1 class="hidden">Help</h1>

            <div class="shortcuts">
                <h2>Keyboard Shortcuts</h2>

                <dl>
                    <dt>?</dt>
                    <dd>Show this help dialog</dd>
                    <dt>S</dt>
                    <dd>Focus the search field</dd>
                    <dt>&larrb;</dt>
                    <dd>Move up in search results</dd>
                    <dt>&rarrb;</dt>
                    <dd>Move down in search results</dd>
                    <dt>&#9166;</dt>
                    <dd>Go to active search result</dd>
                    <dt>+</dt>
                    <dd>Collapse/expand all sections</dd>
                </dl>
            </div>

            <div class="infos">
                <h2>Search Tricks</h2>

                <p>
                    Prefix searches with a type followed by a colon (e.g.
                    <code>fn:</code>) to restrict the search to a given type.
                </p>

                <p>
                    Accepted types are: <code>fn</code>, <code>mod</code>,
                    <code>struct</code>, <code>enum</code>,
                    <code>trait</code>, <code>type</code>, <code>macro</code>,
                    and <code>const</code>.
                </p>

                <p>
                    Search functions by type signature (e.g.
                    <code>vec -> usize</code> or <code>* -> vec</code>)
                </p>
            </div>
        </div>
    </aside>

    

    <script>
        window.rootPath = "../";
        window.currentCrate = "oci_rs";
    </script>
    <script src="../jquery.js"></script>
    <script src="../main.js"></script>
    <script defer src="../search-index.js"></script>
</body>
</html>